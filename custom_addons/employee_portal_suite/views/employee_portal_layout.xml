<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="employee_portal_layout">
        <t t-call="web.layout">
            <style>
                :root {
                    --odoo-primary: #714B67; /* Standard Odoo Purple */
                    --nav-bg: #ffffff;
                    --body-bg: #f8f9fa;
                }

                body {
                    background-color: var(--body-bg);
                    font-family: 'Inter', sans-serif;
                    padding-bottom: 70px; /* Space for bottom nav */
                }

                /* ================= DESKTOP SIDEBAR / TOPBAR ================= */
                .ep-header {
                    background: var(--nav-bg);
                    height: 60px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 0 20px;
                    border-bottom: 1px solid #dee2e6;
                    position: sticky;
                    top: 0;
                    z-index: 1000;
                }

                /* ================= MOBILE BOTTOM NAV ================= */
                .ep-bottom-nav {
                    display: none;
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background: #fff;
                    height: 65px;
                    border-top: 1px solid #eee;
                    display: flex;
                    justify-content: space-around;
                    align-items: center;
                    z-index: 1050;
                    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
                }

                .nav-item {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    color: #6c757d;
                    text-decoration: none;
                    font-size: 11px;
                    flex: 1;
                }

                .nav-item i { font-size: 20px; margin-bottom: 4px; }
                .nav-item.active { color: var(--odoo-primary); font-weight: bold; }

                /* ================= USER SIDEBAR (DRAWER) ================= */
                .ep-drawer {
                    position: fixed;
                    top: 0;
                    right: -300px;
                    width: 300px;
                    height: 100%;
                    background: white;
                    z-index: 2000;
                    transition: 0.3s;
                    box-shadow: -5px 0 15px rgba(0,0,0,0.1);
                    padding: 20px;
                }
                .ep-drawer.open { right: 0; }
                .drawer-overlay {
                    display: none;
                    position: fixed;
                    inset: 0;
                    background: rgba(0,0,0,0.4);
                    z-index: 1999;
                }
                .drawer-overlay.show { display: block; }

                /* ================= RESPONSIVE ADJUSTMENTS ================= */
                @media (max-width: 768px) {
                    .ep-bottom-nav { display: flex; }
                    .ep-header .desktop-links { display: none; }
                    .ep-user-info-desktop { display: none; }
                }

                @media (min-width: 769px) {
                    .ep-bottom-nav { display: none; }
                    body { padding-bottom: 0; }
                }
                
                .badge-notify {
                    background: #ff3b30;
                    color: white;
                    border-radius: 50%;
                    padding: 2px 6px;
                    font-size: 10px;
                    position: absolute;
                    top: 10px;
                }
            </style>

            <t t-call-assets="web.assets_frontend"/>

            <header class="ep-header">
                <div class="d-flex align-items-center">
                    <img src="/web/binary/company_logo" style="height: 35px;" alt="Logo"/>
                    <div class="desktop-links ms-4 d-none d-md-flex gap-3">
                        <a href="/my" class="btn btn-link text-dark fw-bold">Dashboard</a>
                        <div class="dropdown">
                            <button class="btn btn-link text-dark dropdown-toggle" data-bs-toggle="dropdown">Requests</button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="/my/employee/requests">Employee Requests</a></li>
                                <li><a class="dropdown-item" href="/my/employee/material">Material Requests</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="ep-user-trigger cursor-pointer" onclick="toggleDrawer()">
                    <img t-att-src="image_data_uri(request.env.user.partner_id.avatar_128)" class="rounded-circle" width="35" height="35"/>
                </div>
            </header>

            <div class="drawer-overlay" id="overlay" onclick="toggleDrawer()"></div>
            <div class="ep-drawer" id="userDrawer">
                <div class="text-center mb-4">
                    <img t-att-src="image_data_uri(request.env.user.partner_id.avatar_256)" class="rounded-circle mb-2" width="80"/>
                    <h5 t-out="request.env.user.partner_id.name"/>
                    <p class="text-muted small" t-out="request.env.user.partner_id.email"/>
                </div>
                <hr/>
                <div class="list-group list-group-flush">
                    <a href="/my/account" class="list-group-item list-group-item-action border-0"><i class="fa fa-user-circle me-2"></i> My Profile</a>
                    <t t-if="request.env.user.has_group('petty_cash_management.group_portal_petty_cash_user')">
                        <a href="/my/petty-cash" class="list-group-item list-group-item-action border-0"><i class="fa fa-money me-2"></i> Petty Cash</a>
                    </t>
                    <a href="/web/session/logout" class="list-group-item list-group-item-action border-0 text-danger"><i class="fa fa-sign-out me-2"></i> Logout</a>
                </div>
            </div>

            <main>
                <div id="wrap" class="container mt-3">
                    <t t-raw="0"/>
                </div>
            </main>

            <nav class="ep-bottom-nav">
                <a href="/my" t-attf-class="nav-item #{'active' if request.httprequest.path == '/my' else ''}">
                    <i class="fa fa-th-large"></i>
                    <span>Home</span>
                </a>
                <a href="/my/employee/requests" class="nav-item">
                    <i class="fa fa-paper-plane"></i>
                    <span>Requests</span>
                </a>
                <t t-if="any(request.env.user.has_group(g) for g in ['employee_portal_suite.group_employee_portal_manager', 'employee_portal_suite.group_mr_project_manager'])">
                    <a href="/my/employee/approvals" class="nav-item">
                        <i class="fa fa-check-square"></i>
                        <span>Approvals</span>
                    </a>
                </t>
                <a href="javascript:void(0)" onclick="toggleDrawer()" class="nav-item">
                    <i class="fa fa-bars"></i>
                    <span>More</span>
                </a>
            </nav>

            <script>
                function toggleDrawer() {
                    document.getElementById('userDrawer').classList.toggle('open');
                    document.getElementById('overlay').classList.toggle('show');
                }
            </script>
        </t>
    </template>
</odoo>