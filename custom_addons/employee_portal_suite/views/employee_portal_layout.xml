<?xml version="1.0" encoding="UTF-8"?>
<odoo>

<template id="employee_portal_layout">
<t t-call="web.layout">

<t t-call-assets="web.assets_frontend"/>

<style>

/* ===============================
   GLOBAL SYSTEM
================================ */

:root{
    --ep-primary:#4f46e5;
    --ep-primary-light:#eef2ff;
    --ep-border:#e5e7eb;
    --ep-muted:#64748b;
    --ep-bg:#f8fafc;
}

body{
    background:var(--ep-bg);
}

/* ===============================
   NAVBAR
================================ */

.ep-navbar{
    position:sticky;
    top:0;
    z-index:1000;
    background:rgba(255,255,255,0.9);
    backdrop-filter:blur(10px);
    border-bottom:1px solid var(--ep-border);
}

.nav-container{
    display:flex;
    align-items:center;
    justify-content:space-between;
    height:72px;
}

/* LEFT AREA */
.ep-left{
    display:flex;
    align-items:center;
    gap:30px;
}

/* LOGO */
.ep-logo{
    display:flex;
    align-items:center;
    gap:10px;
    font-weight:700;
    font-size:20px;
    text-decoration:none;
    color:#111827;
}

.ep-logo-box{
    width:36px;
    height:36px;
    background:var(--ep-primary);
    color:white;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:10px;
    font-weight:700;
}

/* NAV LINKS */
.ep-nav-links{
    display:flex;
    align-items:center;
    gap:8px;
}

.ep-link,
.ep-dropdown-toggle{
    padding:8px 16px;
    border-radius:10px;
    background:transparent;
    border:none;
    text-decoration:none;
    font-weight:500;
    color:#374151;
    transition:0.2s;
    cursor:pointer;
}

.ep-link:hover,
.ep-dropdown-toggle:hover{
    background:var(--ep-primary-light);
    color:var(--ep-primary);
}

.ep-link.active{
    background:var(--ep-primary-light);
    color:var(--ep-primary);
    font-weight:600;
}

/* DROPDOWN */
.ep-dropdown{
    position:relative;
}

.ep-dropdown-menu{
    display:none;
    position:absolute;
    top:48px;
    left:0;
    min-width:240px;
    background:white;
    border-radius:16px;
    border:1px solid var(--ep-border);
    box-shadow:0 10px 30px rgba(0,0,0,0.08);
    padding:8px 0;
}

.ep-sub-link{
    display:block;
    padding:10px 18px;
    text-decoration:none;
    color:#374151;
    font-size:14px;
    transition:0.2s;
}

.ep-sub-link:hover{
    background:var(--ep-primary-light);
    color:var(--ep-primary);
}

.ep-divider{
    border-top:1px solid var(--ep-border);
    margin:6px 0;
}

/* USER INFO RIGHT */
.ep-right{
    display:flex;
    align-items:center;
    gap:20px;
}

.ep-user-pill{
    display:flex;
    align-items:center;
    gap:12px;
    padding:6px 16px;
    border-radius:999px;
    background:#f1f5f9;
    border:1px solid var(--ep-border);
}

.ep-user-pill img{
    width:34px;
    height:34px;
    border-radius:50%;
    object-fit:cover;
}

.ep-user-info{
    display:flex;
    flex-direction:column;
    line-height:1.1;
}

.ep-user-info h5{
    font-size:14px;
    margin:0;
}

.ep-user-info small{
    font-size:11px;
    font-weight:700;
    text-transform:uppercase;
    color:var(--ep-muted);
    letter-spacing:.5px;
}

.ep-logout{
    font-size:20px;
    color:#9ca3af;
    text-decoration:none;
    transition:0.2s;
}

.ep-logout:hover{
    color:#ef4444;
}

/* MOBILE */
.ep-nav-toggle{
    display:none;
    background:none;
    border:none;
    font-size:24px;
}

@media(max-width:992px){

    .ep-nav-toggle{
        display:block;
    }

    .ep-nav-links{
        position:fixed;
        top:0;
        left:-260px;
        height:100%;
        width:260px;
        flex-direction:column;
        align-items:flex-start;
        padding:80px 20px;
        background:white;
        transition:0.3s;
        box-shadow:4px 0 20px rgba(0,0,0,0.08);
    }

    .ep-nav-links.open{
        left:0;
    }

    .ep-right{
        display:none;
    }

    .ep-dropdown-menu{
        position:relative;
        top:0;
        left:0;
        box-shadow:none;
        border:none;
    }
}

</style>

<!-- NAVBAR -->
<nav class="ep-navbar">
<div class="container nav-container">

    <div class="ep-left">

        <button class="ep-nav-toggle" onclick="toggleMenu()">☰</button>

        <a href="/my" class="ep-logo">
            <div class="ep-logo-box">O</div>
            <span>Portal</span>
        </a>

        <div class="ep-nav-links" id="epMenu">

            <!-- Dashboard -->
            <a href="/my"
               t-att-class="'ep-link active' if request.httprequest.path == '/my' else 'ep-link'">
                Dashboard
            </a>

            <!-- Requests Dropdown -->
            <div class="ep-dropdown">
                <button class="ep-dropdown-toggle"
                        onclick="toggleDropdown(event,'requests-menu')">
                    Requests ▾
                </button>

                <div id="requests-menu" class="ep-dropdown-menu">
                    <a href="/my/employee/requests" class="ep-sub-link">Employee Requests</a>
                    <a href="/my/employee/requests/new" class="ep-sub-link">New Employee Request</a>
                    <hr class="ep-divider"/>
                    <a href="/my/employee/material" class="ep-sub-link">Material Requests</a>
                    <a href="/my/employee/material/new" class="ep-sub-link">New Material Request</a>
                </div>
            </div>

            <!-- Approvals Dropdown (ALL YOUR GROUP LOGIC PRESERVED) -->
            <t t-if="
                request.env.user.has_group('employee_portal_suite.group_employee_portal_manager')
                or request.env.user.has_group('employee_portal_suite.group_employee_portal_hr')
                or request.env.user.has_group('employee_portal_suite.group_employee_portal_finance')
                or request.env.user.has_group('employee_portal_suite.group_employee_portal_ceo')
                or request.env.user.has_group('employee_portal_suite.group_mr_purchase_rep')
                or request.env.user.has_group('employee_portal_suite.group_mr_store_manager')
                or request.env.user.has_group('employee_portal_suite.group_mr_project_manager')
                or request.env.user.has_group('employee_portal_suite.group_mr_projects_director')
            ">
                <div class="ep-dropdown">
                    <button class="ep-dropdown-toggle"
                            onclick="toggleDropdown(event,'approvals-menu')">
                        Approvals ▾
                    </button>

                    <div id="approvals-menu" class="ep-dropdown-menu">

                        <t t-if="
                            request.env.user.has_group('employee_portal_suite.group_employee_portal_manager')
                            or request.env.user.has_group('employee_portal_suite.group_employee_portal_hr')
                            or request.env.user.has_group('employee_portal_suite.group_employee_portal_finance')
                            or request.env.user.has_group('employee_portal_suite.group_employee_portal_ceo')
                        ">
                            <a href="/my/employee/approvals" class="ep-sub-link">
                                Employee Approvals
                            </a>
                        </t>

                        <t t-if="
                            request.env.user.has_group('employee_portal_suite.group_mr_purchase_rep')
                            or request.env.user.has_group('employee_portal_suite.group_mr_store_manager')
                            or request.env.user.has_group('employee_portal_suite.group_mr_project_manager')
                            or request.env.user.has_group('employee_portal_suite.group_mr_projects_director')
                            or request.env.user.has_group('employee_portal_suite.group_employee_portal_ceo')
                        ">
                            <a href="/my/employee/material/approvals" class="ep-sub-link">
                                Material Approvals
                            </a>
                        </t>

                    </div>
                </div>
            </t>

            <!-- Petty Cash -->
            <t t-if="request.env.user.has_group('petty_cash_management.group_portal_petty_cash_user')">
                <a href="/my/petty-cash"
                   t-att-class="'ep-link active' if request.httprequest.path.startswith('/my/petty-cash') else 'ep-link'">
                    Petty Cash
                </a>
            </t>

        </div>
    </div>

    <!-- RIGHT SIDE USER -->
    <div class="ep-right">
        <div class="ep-user-pill">
            <img t-att-src="image_data_uri(request.env.user.partner_id.avatar_1024)"/>
            <div class="ep-user-info">
                <h5 t-out="request.env.user.partner_id.name"/>
                <small t-out="request.env.user.partner_id.company_name"/>
            </div>
        </div>

        <a href="/web/session/logout" class="ep-logout" title="Logout">
            <i class="fa fa-sign-out"></i>
        </a>
    </div>

</div>
</nav>

<!-- PAGE CONTENT -->
<main class="py-5">
<div class="container">
<t t-raw="0"/>
</div>
</main>

</t>

<script>
function toggleDropdown(event,id){
    event.stopPropagation();
    document.querySelectorAll('.ep-dropdown-menu').forEach(m=>{
        if(m.id!==id) m.style.display='none';
    });
    let menu=document.getElementById(id);
    menu.style.display=(menu.style.display==='block')?'none':'block';
}

document.addEventListener('click',function(){
    document.querySelectorAll('.ep-dropdown-menu')
        .forEach(m=>m.style.display='none');
});

function toggleMenu(){
    document.getElementById("epMenu")
        .classList.toggle("open");
}
</script>

</template>
</odoo>
